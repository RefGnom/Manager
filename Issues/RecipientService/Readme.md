# Описание сервиса

RecipientService - это сервис для работы с пользователем:

1. Аутентификация пользователя;
2. Авторизация с разграничением прав на разные ресурсы;
3. Хранение информации о пользователе;
4. Потенциальная монетизация за использование Manager.

# Разработка

### Шаг 1

Начинаем проектировать архитектуру серверного приложения, которая будет
включать в себя:

* Создание аккаунта для пользователя;
* Сохранение его информации в бд;
* Аутентификацию пользователя.

Предварительно хранить в базе будем:

* `RecipientAccount` - табличка с аккаунтами пользователя
    * `Guid Id` - уникальный идентификатор пользователя в среде Manager
    * `string Login` - логин пользователя
    * `string PasswordHash` - хэш пароля пользователя
    * `Guid AccountStateId` - идентификатор состояния
    * `TimeZoneInfo RecipientTimeZone` - информация о часовом поясе пользователя
    * `DateTime CreatedUtc` - время создания аккаунта
    * `DateTime UpdatedUt` - время обновления аккаунта

* `AccountState` - таблица состояний аккаунтов
    * `Guid StateId` - уникальный идентификатор состояния
    * `AccountState State` - Enum. Состояние аккаунта
    * `StateReason Reason` - Enum. Причина по которой аккаунт находится в данном состоянии

* `RecipientAuthorization` (Не нужна на первом шаге)
    * `Guid Id` - уникальный идентификатор сущности авторизации
    * `Guid RecipientId` - уникальный идентификатор пользователя
    * `string[] AllowedServices` - доступные сервисы для использования
    * `string[] AllowedResources` - доступные ресурсы для использования
    * `DateTime CreatedAtUtc` - время создания сущности авторизации
    * `DateTime UpdatedAtUtc` - время обновления сущности авторизации

* `ServiceResource` - таблица для сервисов и их ресурсов
    * `Guid ServiceResourceId` - уникальный идентификатор сервиса-ресурса
    * `string ServiceName` - имя сервиса
    * `string ResourceName` - имя ресурса

* `AuthorizationServiceResourceLink` - таблица для связи модели авторизации пользователя и сервиса-ресурса.
  Многие ко многим
    * `Guid RecipientAuthorizationId` - идентификатор модели авторизации пользователя
    * `Guid ServiceResourceId` - идентификатор сервиса-ресурса

`AccountState` имеет следующие значения:
* `Unknown` - Неизвестно. Является значением по умолчанию в случае аномалий данных
* `Inactive` - Неактивный. Стартовое состояние, запрещает пользоваться аккаунтом
* `Active` - Активный. Разрешает пользоваться аккаунтом
* `Deleted` - Удалённый. Запрещает пользоваться аккаунтом
* `Banned` - Заблокированный. Запрещает пользоваться аккаунтом

`StateReason` имеет следующие значения:
* `Unknown` - Неизвестно. Является значением по умолчанию в случае аномалий данных
* `NewUser` - Новый пользователь. Является причиной для (AccountState.Inactive)
* `ActivatedByAdmin` - Активированный администратором. (AccountState.Active)
* `RestoredByUserRequest` - Восстановленный по запросу пользователя (AccountState.Active)
* `Unbanned` - Разблокированный (AccountState.Active)
* `DeletedByUserRequest` - Удалён по запросу пользователя (AccountState.Deleted)
* `Banned` - Заблокированный (AccountState.Banned)

#### Результат

После первого шага у нас должно получится простое приложение, которое позволяет:

1. Создать аккаунт пользователя с логином и паролем
2. Получить аккаунт по его идентификатору `RecipientId`
3. Удалить аккаунт (soft-delete) по его идентификатору `RecipientId`
4. Поменять модель аккаунта. Логин, пароль, временную зону
5. Получить статус авторизации по идентификатору `RecipientId`.
   Временно сделать заглушку, чтобы всегда возвращался ответ с успешной авторизацией
6. Логика покрыта юнит и интеграционными тестами
7. API должно быть построено по стандарту REST

### Шаг 2

Нужно написать C# клиент для RecipientService. В нём должны быть реализованны созданные методы в шаге 1.
Можно ориентироваться на `AuthenticationService.Client`

#### Результат

В клиенте должны быть следующие методы:

1. Создание аккаунта
2. Получение аккаунта
3. Удалить аккаунт
4. Обновить аккаунт
5. Получение статуса авторизации

### Шаг 3

Реализация авторизации по сервису и ресурсу.